(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2849:(e,t,a)=>{Promise.resolve().then(a.bind(a,8152))},8152:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),n=a(2115),s=a(2818);function l(){let[e,t]=(0,n.useState)([{id:"1",type:"ai",content:"こんにちは！あなぶき興産データ分析システムへようこそ。物件情報、顧客データ、Webアクセスログなどについて、日本語でご質問ください。",timestamp:new Date}]),[a,l]=(0,n.useState)(""),[o,i]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),m=(0,n.useRef)(null),u=()=>{var e;null===(e=m.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{u()},[e]);let x=async r=>{if(r.preventDefault(),!a.trim()||o)return;let n={id:Date.now().toString(),type:"user",content:a,timestamp:new Date};t(e=>[...e,n]),l(""),i(!0);try{let a,r;let l=e.filter(e=>"ai"===e.type).slice(-5).map(e=>({query:"",response:e.content,timestamp:e.timestamp.toISOString(),queryType:"unknown"})),o=parseInt(s.env.NEXT_PUBLIC_API_TIMEOUT||"30000"),m=new AbortController,u=setTimeout(()=>m.abort(),o);try{a=await fetch("https://clado.app.n8n.cloud/webhook/ask-data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n.content,timestamp:n.timestamp.toISOString(),sessionId:c,conversationHistory:l}),signal:m.signal})}catch(e){if("AbortError"===e.name){let e={id:Date.now().toString(),type:"ai",content:"⏱️ リクエストがタイムアウトしました。\n\nデータ処理に時間がかかっています。もう一度お試しいただくか、より具体的な条件でクエリを絞り込んでください。",timestamp:new Date};t(t=>[...t,e]),i(!1);return}throw e}finally{clearTimeout(u)}if(!a.ok){let e=await a.json();if("n8nワークフローが無効です"===e.error){let a={id:Date.now().toString(),type:"ai",content:"⚠️ ".concat(e.explanation,"\n\n\uD83D\uDCA1 ").concat(e.hint),timestamp:new Date};t(e=>[...e,a]),i(!1);return}let r={id:Date.now().toString(),type:"ai",content:"❌ エラー: ".concat(e.error||"API呼び出しに失敗しました","\n\n").concat(e.explanation||"もう一度お試しください。"),timestamp:new Date};t(e=>[...e,r]),i(!1);return}let x=await a.text();try{r=x?JSON.parse(x):{}}catch(a){console.error("JSON Parse Error:",a),console.error("Response Text:",x);let e={id:Date.now().toString(),type:"ai",content:"⚠️ サーバーからの応答が不正です。n8nワークフローが正しく設定されているか確認してください。",timestamp:new Date};t(t=>[...t,e]),i(!1);return}let b=c||"session-".concat(Date.now());c||d(b),console.log("n8n Response:",r);let h="";if(r.error?(h="⚠️ エラーが発生しました: ".concat(r.error),r.error_details&&(h+="\n\n詳細: ".concat(r.error_details))):!1===r.success?h="⚠️ クエリの実行に失敗しました。":!0===r.success&&(h="データ分析が完了しました。",r.webhook_query&&(h="「".concat(r.webhook_query,"」についてデータを分析しました。"))),r.claude_sql&&(h+="\n\n実行したクエリ:\n```sql\n".concat(r.claude_sql,"\n```")),r.redshift_results){let e=r.redshift_results;if(Array.isArray(e)&&e.length>0){h+="\n\n\uD83D\uDCCA 結果: ".concat(e.length,"件のデータを取得しました。");let t=e.slice(0,5);if(t.length>0){let a=Object.keys(t[0]);h+="\n\n",h+="| "+a.join(" | ")+" |\n",h+="|"+a.map(()=>"---").join("|")+"|\n",t.forEach(e=>{h+="| "+a.map(t=>{let a=e[t];return null==a?"-":"number"==typeof a&&t.includes("amount")?new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(a):String(a)}).join(" | ")+" |\n"}),e.length>5&&(h+="\n... 他 ".concat(e.length-5," 件のデータ"))}}else Array.isArray(e)&&0===e.length?h+="\n\n\uD83D\uDCED 該当するデータが見つかりませんでした。":"object"==typeof e&&Object.keys(e).length>0&&(h+="\n\n\uD83D\uDCCA 結果:\n",Object.entries(e).forEach(e=>{let[t,a]=e;h+="• ".concat(t,": ").concat(a,"\n")}))}if(r.execution_time){let e=new Date(r.execution_time);h+="\n\n実行時刻: ".concat(e.toLocaleString("ja-JP"))}let p={id:(Date.now()+1).toString(),type:"ai",content:h,timestamp:new Date};t(e=>[...e,p])}catch(r){console.error("API Error:",r);let e="申し訳ございません。エラーが発生しました。";r instanceof Error&&(e=r.message.includes("NetworkError")||r.message.includes("Failed to fetch")?"\uD83C\uDF10 ネットワークエラー\n\nサーバーに接続できませんでした。インターネット接続を確認してください。":r.message.includes("CORS")?"\uD83D\uDD12 CORS エラー\n\nn8nワークフローのCORS設定を確認してください。":"⚠️ エラーが発生しました\n\n".concat(r.message));let a={id:(Date.now()+1).toString(),type:"ai",content:e,timestamp:new Date};t(e=>[...e,a])}finally{i(!1)}},b=e=>{l(e)};return(0,r.jsxs)("div",{className:"min-h-screen relative",style:{backgroundImage:"url('https://readdy.ai/api/search-image?query=Luxury%20high-end%20fashion%20boutique%20interior%20with%20modern%20minimalist%20design%2C%20premium%20clothing%20displays%2C%20elegant%20lighting%2C%20marble%20floors%2C%20sophisticated%20retail%20environment%2C%20clean%20white%20and%20blue%20color%20scheme%2C%20professional%20commercial%20space%20with%20designer%20garments%20on%20display%20racks%2C%20contemporary%20luxury%20shopping%20atmosphere&width=1920&height=1080&seq=lumine-bg-001&orientation=landscape')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-white/60 backdrop-blur-sm"}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col min-h-screen",children:[(0,r.jsx)("header",{className:"bg-white/95 backdrop-blur-sm border-b border-blue-200 shadow-sm",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-6 py-4",children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("img",{src:"https://static.readdy.ai/image/60a7852ea0ff95e4321c1f6f322cd6f8/33f7c24daa878e3690d3e52fceb1885a.png",alt:"LUMINE Logo",className:"h-10 w-auto"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-blue-900",style:{fontFamily:"var(--font-playfair-display)"},children:"Data Intelligence Platform"})]})})})}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col max-w-4xl mx-auto w-full px-6 py-6",children:[(0,r.jsxs)("div",{className:"flex-1 bg-white/90 backdrop-blur-md rounded-2xl shadow-xl border border-blue-200 mb-6 overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",style:{maxHeight:"500px"},children:[e.map(e=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[70%] rounded-2xl p-4 ".concat("user"===e.type?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800"),children:[(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:e.content}),(0,r.jsx)("p",{className:"text-xs mt-2 ".concat("user"===e.type?"text-blue-100":"text-gray-500"),children:e.timestamp.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})},e.id)),o&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 rounded-2xl p-4 max-w-[70%]",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-blue-400/30 border-t-blue-400 rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-gray-600 text-sm",children:"分析中..."})]})})}),(0,r.jsx)("div",{ref:m})]}),(0,r.jsx)("div",{className:"border-t border-blue-200 p-4 bg-white/50",children:(0,r.jsxs)("form",{onSubmit:x,className:"flex space-x-3",children:[(0,r.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),placeholder:"データに関する質問を日本語で入力してください...",className:"flex-1 px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-400 focus:outline-none text-blue-800 placeholder-gray-500 bg-white/80",disabled:o}),(0,r.jsx)("button",{type:"submit",disabled:!a.trim()||o,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-medium rounded-xl hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl",children:(0,r.jsx)("i",{className:"ri-send-plane-fill text-lg"})})]})})]}),(0,r.jsxs)("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl p-4 border border-blue-200 shadow-lg",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-blue-800 mb-3 flex items-center",children:[(0,r.jsx)("i",{className:"ri-lightbulb-line text-blue-500 mr-2"}),"よく使われる質問例："]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:["都道府県別の顧客数","物件のコンバージョン履歴","県別の顧客情報","最新のWebアクセス","家族構成の分布","モデルルームの来場者数","成約までの期間"].map((e,t)=>(0,r.jsx)("button",{onClick:()=>b(e),className:"px-3 py-1.5 bg-gradient-to-r from-blue-100 to-sky-100 text-blue-700 rounded-full hover:from-blue-200 hover:to-sky-200 transition-all duration-200 text-xs font-medium border border-blue-300 hover:border-blue-400",children:e},t))})]})]}),(0,r.jsx)("footer",{className:"bg-white/95 backdrop-blur-sm border-t border-blue-200 py-4",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-6 text-center",children:(0,r.jsx)("p",{className:"text-sm text-blue-600",children:"Powered by ABK Real Estate Data Analytics System"})})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,517,358],()=>t(2849)),_N_E=e.O()}]);